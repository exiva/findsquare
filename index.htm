<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
		 "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<title>findsquare</title>
			<link rel="stylesheet" href="css/screen.css" type="text/css" media="screen" charset="utf-8" />
			<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=ABQIAAAADvX7JTQepUAsPqvc7tt61hSaI6nr3FIZupmt7q9pPJlCdwl6thRh5b_qNMis4C5tEcV798TD-5PLRg" type="text/javascript"></script>
			<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
			<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
			<script type="text/javascript">
				$(document).ready(function(){
					//load categories.
					var cat_url = "https://api.foursquare.com/v2/venues/categories?oauth_token=HVBP350OQHKOOCN0VD1ZS30VK5EWRDD13XBBKI2GRR4CC2WV";
					$.getJSON(cat_url,function(cat_json){
						if (cat_json.meta.code == 200) {
							document.getElementById('categories').innerHTML = "";
							$("#categories").append('<option>Select a Category</option>');
							$.each(cat_json.response.categories, function(i, category) {
								$("#categories").append('<optgroup label="'+category.name+'">');
								$.each(category.categories, function(i, data) {
									$("#categories").append('<option value="'+data.id+'">'+data.pluralName+'</option>');
								});
				 			});
						};
					});

					$("#load").click(function(){
						if (window.lat == null || window.lon == null) {
							alert("Select an area on the map.");
						} else if (window.catID == null) {
							alert("Select a category.");
						} else {
							//load venue datas.
							var date = $.datepicker.formatDate('yymmdd', new Date())
							var venue_url = "https://api.foursquare.com/v2/venues/search";
							var oAuth = "HVBP350OQHKOOCN0VD1ZS30VK5EWRDD13XBBKI2GRR4CC2WV";
							$.getJSON(venue_url+'?ll='+window.lat+','+window.lon+'&categoryId='+window.catID+'&radius=20000&oauth_token='+oAuth+'&v='+date, function(venue_json){
								document.getElementById('venuelist').innerHTML = "";
								if (venue_json.meta.code == 200) {
									var l = venue_json.response.venues.length;
									$("#venuelist").append('<h2>Found '+l+' matching venues</h2>');
									//run through the venues we found.
									$.each(venue_json.response.venues, function(i, venue) {
										var name = venue.name;
										var address = venue.location.address;
										var crossStreet = venue.location.crossStreet;
										var city = venue.location.city;
										var state = venue.location.state;
										var zip = venue.location.postalCode;
										var missing = false;
										if (name==undefined) { missing=true; name="<strong>Missing Name</strong>"; };
										if (address==undefined) { missing=true; address="<strong>Missing Address</strong>"; };
										if (crossStreet==undefined) { missing=true; crossStreet="<strong>Missing Cross Street</strong>"; };
										if (city==undefined) { missing=true; city="<strong>Missing City</strong>"; };
										if (state==undefined) { missing=true; state="<strong>Missing State</strong>"; };
										if (zip==undefined) { missing=true; zip="<strong>Missing Postal Code</strong>"}
										
										if (missing==true) {$("#venuelist").append('<p>This venue is missing some data, why not fix it? <a href="http://foursquare.com/v/'+venue.id+'/edit">Edit Venue</a></p>')};
										$("#venuelist").append('<p><strong>'+name+'</strong><br />');
										$("#venuelist").append(address+' ('+crossStreet+')<br />');
										$("#venuelist").append(city+', '+state+' '+zip+'</p>');
										$("#venuelist").append("<h3>In Categories:</h3><p>");
										$.each(venue.categories, function(i, categories) {
											var category = categories.pluralName;
											var iconURL = categories.icon;
											$("#venuelist").append('<img src="'+iconURL+'" alt="'+category+'" /> '+category+'<br />');

										});
										$("#venuelist").append('</p<p>');
										
										if (venue.location.city==undefined || venue.location.state==undefined) {
											$("#venuelist").append('<a href="http://www.google.com/search?q='+encodeURI(name)+'">Google It!</a>');
											$("#venuelist").append(' | <a href="http://www.yelp.com/search?find_desc='+encodeURI(name)+'&ns=1&find_loc=">Yelp It!</a>');
											$("#venuelist").append(' | <a href="https://foursquare.com/v/'+venue.id+'">Open Venue</a></p>');
										} else {
											$("#venuelist").append('<a href="http://www.google.com/search?q='+encodeURI(name)+' near '+city+', '+state+'">Google It!</a>');
											$("#venuelist").append(' | <a href="http://www.yelp.com/search?find_desc='+encodeURI(name)+'&ns=1&find_loc='+encodeURI(city+', '+state)+'">Yelp It!</a>');
											$("#venuelist").append(' | <a href="https://foursquare.com/v/'+venue.id+'">Open Venue</a></p>');
										};
											
										$("#venuelist").append('<hr>');
									});
								};
							});
						};
					});
				});

				function updateMap(address) {
					var geocoder = new GClientGeocoder();
					geocoder.getLatLng(address, goToMap);
				};

				function goToMap(latlng) {
					if (!latlng) {
						alert(address+' Not found');
					} else {
						map.clearOverlays();
						map.setCenter(latlng, 13);
						var marker = new GMarker(latlng, {draggable: true});
						map.addOverlay(marker);
						window.lat = marker.getPoint().y;
						window.lon = marker.getPoint().x;
					}					
				}
			</script>
	</head>

<body>
	<a href="https://github.com/exiva/findsquare"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/30f550e0d38ceb6ef5b81500c64d970b7fb0f028/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub"></a>
	<div id="container">
		<div id="content">
			<h1>
				findsquare
			</h1>
			<p id="tagline">Help keep foursquare clean</p>

			<h2>
				Choose a Category to clean:
			</h2>
			<select id="categories" onChange="window.catID=this.value;">
				<option>Loading....</option>
			</select>

			<h2>
				Choose an Area to clean:
			</h2>

			<input type="text" name="zipcode" value="Enter a zip Code" id="zip" />
			<button id="remap" onclick="updateMap(document.getElementById('zip').value)">Go</button>
			<div id="map_canvas" style="width: 600px; height: 400px"></div>
			<script>
				//<![CDATA[
				var map = new GMap2(document.getElementById("map_canvas"));
				var center = new GLatLng(40.72880, -73.99112);
				map.setUIToDefault();
				map.setCenter(center, 13);
				var marker = new GMarker(center, {draggable: true});
				window.lat = marker.getPoint().y;
				window.lon = marker.getPoint().x;

				GEvent.addListener(marker, "dragend", function(overlay, point) {
					window.lat = marker.getPoint().y;
					window.lon = marker.getPoint().x;
		        });

		        map.addOverlay(marker);
				//]]>
			</script>

			<button id="load">Find Venues</button>

			<div id="venuelist"></div>

			<span>
				<p id="built">Built during foursquare Hackaton 2011 by <a href="http://twitter.com/exiva">@exiva</a>
				<p id="about"><a href="about.htm">About</a></p>
			</span>
		</div>
	</div>

	<div class="botright">
  		<p><a href="http://www.youtube.com/watch?v=RE0DwzmrVQc#t=674s">Ï€</a></p>
	</div>
</body>